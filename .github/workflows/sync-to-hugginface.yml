name: Sync to Hugging Face Space

on:
  push:
    branches:
      - main
  workflow_dispatch:  # Allows manual triggering

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true

      - name: Push to Hugging Face Space
        uses: alex-bene/huggingface-space-sync-action@v0.1
        with:
          github_repo_id: "${{ github.repository }}"
          github_branch: "main"
          yaml_header_path: "space.yml"  
          huggingface_repo_id: "${{ secrets.HF_USER }}/${{ secrets.HF_REPO }}"
          hf_username: "${{ secrets.HF_USER }}"
          hf_token: "${{ secrets.HF_TOKEN }}"
          push : false
      # Then, manually force push to the Hugging Face Space
      - name: Force push to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          HF_USER: ${{ secrets.HF_USER }}
          HF_REPO: ${{ secrets.HF_REPO }}
        run: |
          cd ${{ steps.prepare.outputs.workspace_path || '.' }}
          git remote add space https://$HF_USER:$HF_TOKEN@huggingface.co/spaces/$HF_USER/$HF_REPO
          git push --force space main:main
        #env:
        #  HF_TOKEN: ${{ secrets.HF_TOKEN }}
        #  HF_USER : ${{ secrets.HF_USER }}
        #  HF_REPO : ${{ secrets.HF_REPO }}
        #run: |

        #  echo $HF_TOKEN | sed 's/./& /g'
        #  echo $HF_USER | sed 's/./& /g'
        #  echo $HF_REPO | sed 's/./& /g'
        #  git push https://$HF_USER:$HF_TOKEN@huggingface.co/spaces/$HF_USER/$HF_REPO main
